# 欧氏距离与勾股定理：前端实践

## 一、原理

在二维或三维坐标中，常用以下公式计算两点之间的距离：


```math
distance = √((x₂ - x₁)² + (y₂ - y₁)²)
```


这个公式被称为 **欧氏距离（Euclidean Distance）**，  
它来源于 **勾股定理（Pythagorean Theorem）**：


```math
c^2 = a^2 + b^2
```


在欧几里得几何中，两点之间的最短直线距离就是由勾股定理推导得来的。

---

## 二、在前端中的常见应用

欧氏距离公式在前端开发中非常常见，例如：

- 🎮 **Canvas 拖拽与触摸移动**：判断元素是否移动超过一定距离。  
- 🟣 **碰撞检测**：判断两个圆、点或物体是否接触。  
- 🧭 **交互半径判断**：判断鼠标是否进入某个热点区域。  
- 💫 **动画与物理模拟**：计算力的方向与强度。  
- 🧩 **自定义组件（如摇杆、缩放控件）**：计算角度、力度、方向。

---

## 三、开根号 vs 不开根号

计算距离时，我们通常会写：

```js
const dx = x2 - x1
const dy = y2 - y1
const distance = Math.sqrt(dx * dx + dy * dy)
```

但实际上，「开根号」并不总是必须的。

如果只是比较远近或判断是否超出某个范围，可以省略 Math.sqrt：

```js
const dist2 = dx * dx + dy * dy
if (dist2 > 100*100) {
  // 超过 100 像素，不必开根号
}
```

### 1、为什么开根号会影响性能？

```Math.sqrt() ```不是一个普通的算术操作，它是一个 复杂的浮点函数，需要底层 CPU 做额外计算。

原理：

1. 加减乘除 是 CPU 的基础指令（1~3个时钟周期就能完成）；

1. 平方根 需要使用牛顿迭代法或硬件 FPU 指令（例如 FSQRT），一般要 十几个甚至上百个时钟周期；

1. 同时还涉及 浮点数精度和舍入处理。

因此，在循环或需要实时计算（比如 Canvas 动画、3D 碰撞检测、物理引擎）中频繁调用 Math.sqrt()，就可能产生性能瓶颈。

### 2、场景

| 情况         | 是否要优化                                |
| ---------- | ------------------------------------ |
| 偶尔计算一次距离   | 不必担心                                 |
| 循环上万次的几何计算 | ✅ 优化：用平方比较法                          |
| 实时渲染、物理引擎  | ✅ 避免 `Math.sqrt()`，或用 WebAssembly 加速 |
| 普通业务逻辑     | ❌ 无意义的优化                             |


### 3、优缺点

| 方式                    | 优点                    | 缺点                  | 适用场景                  |
| --------------------- | --------------------- | ------------------- | --------------------- |
| **开根号** (`Math.sqrt`) | 得到真实的距离值，可直接用于显示、角度计算 | 运算开销较大（CPU 需多次迭代近似） | 需要真实长度的情况，如 UI 提示、归一化 |
| **不开根号** (平方距离)       | 运算快，性能高，逻辑等价          | 结果为距离平方，不能直接显示长度    | 仅需比较远近或范围判断，如碰撞检测     |

## 四、性能测试（Canvas 示例）

以下是一个对比示例：在 Canvas 中渲染 10,000 个点，并实时计算它们到鼠标的距离。

useSqrt = true → FPS 约 40–50

useSqrt = false → FPS 约 70–90

差距约 30%–60%，说明 Math.sqrt() 是性能瓶颈之一。

```js
const dx = p.x - mouse.x
const dy = p.y - mouse.y
const dist2 = d x* dx + dy * dy
const dist = useSqrt ? Math.sqrt(dist2) : dist2
```


在高频计算（如动画帧或物理模拟）中，减少开根号操作能显著提升性能。

## 五、总结

- 勾股定理 描述了平方关系：a<sup>2</sup> + b<sup>2</sup> = c<sup>2</sup>
- 欧氏距离 是勾股定理在坐标空间中的直接应用
- 开根号 得到真实距离；不开根号 性能更高，用于比较判断。
> 🧠 实际开发中：
> - 需要“长度” → 开根号
> - 只比较“远近” → 不开根号
> - 先判断再精算 → 性能与准确兼得

欧氏距离来自勾股定理，理解开根号的取舍，是写出高性能交互逻辑的关键。
