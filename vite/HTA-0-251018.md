# ğŸ§© Monorepo é¡¹ç›®åˆå§‹åŒ–æŒ‡å—

ä½¿ç”¨ Vite + Vue 3 æ„å»ºç°ä»£å‰ç«¯ Monorepoã€‚

é…ç½® TypeScript + ESLint + Prettier + Husky + lint-staged

## ğŸ“¦ ä½¿ç”¨ pnpm åˆå§‹åŒ–

### å®‰è£… pnpm

```bash
npm install -g pnpm
```

### åˆå§‹åŒ–ä¸»é¡¹ç›®
```bash
pnpm init
```

### æ–°å»º pnpm-workspace.yaml

åœ¨æ ¹ç›®å½•åˆ›å»º pnpm-workspace.yamlï¼Œå¹¶åˆ›å»ºä¸å­åŒ…åå­—ç›¸åŒçš„**æ–‡ä»¶å¤¹**ï¼Œç„¶åè®¾ç½®å­åŒ…ç›®å½•ï¼Œ
```yaml
packages:
  - "packages"  # æ ¸å¿ƒä»£ç (core)
  - "play"      # æ²™ç›’ç¯å¢ƒ/å¼€å‘/æµ‹è¯•
  - "docs"      # æ–‡æ¡£
```
æ”¯æŒå¤šå±‚ç›®å½•ç»“æ„ï¼Œå¦‚ï¼š
```yaml
  - "test/"  # test/uiã€test/utils
```

### åˆå§‹åŒ–å­åŒ…
åœ¨å¯¹åº”æ–‡ä»¶å¤¹ä¸­æ‰§è¡Œï¼š

```bash
cd packages/play
pnpm init
```

## âš™ï¸ TypeScript é…ç½®

åœ¨æ ¹ç›®å½•å®‰è£… TypeScriptï¼š
```bash
pnpm add typescript -Dw
```

Vue é¡¹ç›®æ¨èåŒæ—¶å®‰è£… vue-tscï¼Œç”¨äºç±»å‹æ£€æŸ¥ï¼š
```bash
pnpm add vue-tsc -Dw
```

åœ¨ Node.js ä¸­ç›´æ¥è¿è¡Œ TypeScriptï¼š
```bash
pnpm add jiti -Dw
```

æ–°å»º tsconfig.json
```json
{
    "files": [],
    "references": [
        { "path": "./packages" },
        { "path": "./play" },
        { "path": "./docs" }
    ],
    "compilerOptions": {
        "composite": true,
        "declaration": true,
        "declarationMap": true,
        "sourceMap": true,
        "outDir": "dist",
        "module": "ESNext",
        "target": "ESNext",
        "moduleResolution": "Bundler",
        "esModuleInterop": true,
        "strict": true,
        "skipLibCheck": true,
        "baseUrl": ".",
        "rootDir": ".",
        "paths": {
            "packages/*": ["packages/*"]
        }
    }
}
```

å­åŒ…å¯ä»¥ç»§æ‰¿ä¸»åŒ…çš„ tsconfig.jsonï¼š

```json
{
  "extends": "../tsconfig.json",
  "include": ["src"]
}
```

æœ€ååœ¨ä¸»åŒ…çš„`package.json`æ–‡ä»¶ä¸­çš„`scripts`å¢åŠ `type-check`å‘½ä»¤
```json
{
  "scripts": {
    "type-check": "vue-tsc --build",
  }
}
```

## ğŸ§¹ ESLint é…ç½®

```bash
pnpm add eslint eslint-plugin-unused-imports eslint-plugin-vue @vue/eslint-config-prettier @vue/eslint-config-typescript -Dw
```

### æ¨èæ’ä»¶è¯´æ˜
| åŒ…å                                | ä½œç”¨                      | å¿…é¡»    | è¯´æ˜                                   |
| --------------------------------- | ----------------------- | ----- | ------------------------------------ |
| **eslint**                        | æ ¸å¿ƒ ESLint å¼•æ“            | âœ… å¿…é¡»  | æä¾›è§„åˆ™ç³»ç»Ÿä¸æ’ä»¶æœºåˆ¶                          |
| **eslint-plugin-vue**             | Vue å®˜æ–¹æ’ä»¶ï¼Œæ”¯æŒ `.vue` æ–‡ä»¶æ£€æŸ¥ | âœ… å¿…é¡»  | å¯ç”¨ `plugin:vue/vue3-recommended` ç­‰è§„åˆ™ |
| **eslint-plugin-unused-imports**  | è‡ªåŠ¨æ¸…ç†æœªä½¿ç”¨çš„ `import`       | âš™ï¸ å¯é€‰ | æ­é… `eslint --fix` è‡ªåŠ¨æ¸…ç†               |
| **@vue/eslint-config-typescript** | Vue + TS è§„åˆ™é›†            | âœ… æ¨è  | é›†æˆ `@typescript-eslint`              |
| **@vue/eslint-config-prettier**   | ç¦ç”¨ä¸ Prettier å†²çªçš„è§„åˆ™      | âœ… æ¨è  | ä¿è¯ä¸¤è€…ååŒå·¥ä½œ                             |

### æ–°å»º eslint.config.ts

```ts
import { globalIgnores } from 'eslint/config';
import { defineConfigWithVueTs, vueTsConfigs } from '@vue/eslint-config-typescript';
import pluginVue from 'eslint-plugin-vue';
import skipFormatting from '@vue/eslint-config-prettier/skip-formatting';
import UnusedImports from 'eslint-plugin-unused-imports';

export default defineConfigWithVueTs(
  globalIgnores(['**/dist/**', '**/dist-ssr/**', '**/coverage/**']),

  pluginVue.configs['flat/essential'],
  vueTsConfigs.recommended,
  skipFormatting,

  {
    name: 'app/files-to-lint',
    files: ['**/*.{ts,mts,tsx,vue}'],
    plugins: {
      'unused-imports': UnusedImports,
    },
    rules: {
      'vue/multi-word-component-names': 'off',
      '@typescript-eslint/no-explicit-any': 'off',
      '@typescript-eslint/no-unused-vars': 'error',
      // "@typescript-eslint/no-unused-expressions": "off",
      'unused-imports/no-unused-imports': 'error',
    },
  },
);
```

æœ€ååœ¨ä¸»åŒ…çš„`package.json`æ–‡ä»¶ä¸­çš„`scripts`å¢åŠ `lint`å‘½ä»¤
```json
{
  "scripts": {
    "lint": "eslint .",
    "lint:fix": "eslint . --fix",
  }
}
```

## ğŸ¨ Prettier é…ç½®

```bash
pnpm add prettier -Dw
```
### æ–°å»º .prettierrc.json

```json
{
  "$schema": "https://json.schemastore.org/prettierrc",
  "semi": true,
  "singleQuote": true,
  "printWidth": 100
}
```

æœ€ååœ¨ä¸»åŒ…çš„`package.json`æ–‡ä»¶ä¸­çš„`scripts`å¢åŠ `format`å‘½ä»¤
```json
{
  "scripts": {
    // é€‰æ‹©ä½ çš„æ–‡ä»¶å¤¹å³å¯
    "format": "prettier --write packages/**/*.{ts,tsx,vue} play/src/*.{ts,tsx,vue}",
  }
}
```

## ğŸ’¡ IDE é…ç½®

åœ¨æ ¹ç›®å½•åˆ›å»º .vscode æ–‡ä»¶å¤¹ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹æ–‡ä»¶ï¼š

`.vscode/extensions.json`

```json
{
  "recommendations": [
    "Vue.volar",
    "dbaeumer.vscode-eslint",
    "EditorConfig.EditorConfig",
    "esbenp.prettier-vscode"
  ]
}
```

`.vscode/settings.json`
```json
{
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },
  "eslint.validate": ["javascript", "typescript", "vue"],
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "[vue]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  }
}
```

åœ¨æ ¹ç›®å½•åˆ›å»º `.editorconfig`
```ini
[*.{js,jsx,mjs,cjs,ts,tsx,mts,cts,vue,css,scss,sass,less,styl}]
charset = utf-8
indent_size = 2
indent_style = space
insert_final_newline = true
trim_trailing_whitespace = true

end_of_line = lf
max_line_length = 100
```

## âš¡ Vite + Vue 3 å­åŒ…é…ç½®

è¿›å…¥å­åŒ…ï¼ˆä¾‹å¦‚ `play`ï¼‰ï¼š
```bash
cd play
pnpm add vue
pnpm add vite @vitejs/plugin-vue -D
```

ä¿®æ”¹ play/package.jsonï¼š
```json
{
  "name": "play",
  "private": true,  // ä¿®æ”¹
  "type": "module", // ä¿®æ”¹
  "scripts": {
    "dev": "vite"
  },
  "packageManager": "pnpm@10.14.0",
  "dependencies": {
    "vue": "^3.5.22"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^5.2.4",
    "vite": "^6.3.5",
  }
}
```
åˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼š
```csharp
play/
 â”œâ”€ public/
 â”œâ”€ index.html
 â””â”€ src/
    â”œâ”€ App.vue
    â””â”€ main.ts
```

æœ€ååœ¨ä¸»åŒ…çš„`package.json`æ–‡ä»¶ä¸­çš„`scripts`å¢åŠ `play`å‘½ä»¤
```json
{
  "scripts": {
    "play": "pnpm --filter play dev",
  }
}
```

### åœ¨ play å­åŒ…ä¸­å¼•å…¥å¹¶é“¾æ¥ packages å­åŒ…ä½œä¸ºä¾èµ–ã€‚

```json
{
  "name": "play",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite"
  },
  "packageManager": "pnpm@10.14.0",
  "dependencies": {
    "vue": "^3.5.22"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^5.2.4",
    "vite": "^6.3.5",

    // æ–°å¢å­åŒ…ï¼Œpackagesè¦ä¸å­åŒ…åŒå
    "packages": "workspace:*"
  }
}
```

æ·»åŠ åï¼Œåœ¨æ ¹ç›®å½•è¿è¡Œï¼š
```bash
pnpm install
```

æ·»åŠ å®Œæˆåï¼Œéœ€è¦åœ¨playå­åŒ…çš„tsconfig.jsonä¸­
```json
{
  "extends": "../tsconfig.json",

  // ../packages/*ï¼šé“¾æ¥ packages å­åŒ…ç±»å‹
  "include": ["src", "../packages/*"]
}
```

## ğŸª„ Husky + lint-staged é…ç½®

å®‰è£…ï¼š
```bash
pnpm add husky lint-staged -Dw
```

åˆå§‹åŒ– Git ä¸ Husky
```bash
git init  # å·²æœ‰git åˆ™ä¸éœ€è¦
npx husky init
```
åœ¨ä¸»åŒ…çš„`package.json`æ–‡ä»¶æ–°å¢è„šæœ¬å‘½ä»¤
```json
{
    "scripts": {
      "test": "echo \"Error: no test specified\" && exit 1",
      "type-check": "vue-tsc --build",
      "lint": "eslint .",
      "lint:fix": "eslint . --fix",
      "format": "prettier --write packages/**/*.{ts,tsx,vue} play/src/*.{ts,tsx,vue}",
      "play": "pnpm --filter play dev",

      // æ–°å¢
      "precommit": "pnpm run type-check && pnpm lint-staged",
    },

    // æ–°å¢
    "lint-staged": {
        "*.{js,ts,vue}": [
        "eslint --fix",
        "prettier --write"
        ]
    },
}
```
ç¼–è¾‘ .husky/pre-commit
```sh
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running precommit" >&2

pnpm run precommit
```

è¿™æ ·ï¼Œå½“æ‰§è¡Œ git commit æ—¶ï¼Œæš‚å­˜åŒºä»£ç ä¼šè‡ªåŠ¨æ‰§è¡Œ ESLint + Prettier æ ¡éªŒä¸æ ¼å¼åŒ–ã€‚

## âœ… æ€»ç»“
Monorepo ç»“æ„åº”å¦‚ä¸‹æ‰€ç¤ºï¼š

```csharp
project/
â”œâ”€ .husky/                        # Husky é’©å­ç›®å½•ï¼ˆGit æäº¤å‰è‡ªåŠ¨æ‰§è¡Œ ESLintã€Prettier ç­‰ï¼‰
â”‚   â””â”€ pre-commit                 # æäº¤å‰è§¦å‘çš„è„šæœ¬ï¼ˆæ‰§è¡Œ lint-stagedï¼‰
â”‚
â”œâ”€ .vscode/                       # VSCode é¡¹ç›®ä¸“ç”¨é…ç½®
â”‚   â”œâ”€ extensions.json            # æ¨èå®‰è£…çš„æ’ä»¶ï¼ˆVolarã€ESLintã€Prettier ç­‰ï¼‰
â”‚   â””â”€ settings.json              # VSCode ç¼–è¾‘å™¨è§„åˆ™ï¼ˆä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ã€ESLint æ ¡éªŒç­‰ï¼‰
â”‚
â”œâ”€ packages/                      # æ ¸å¿ƒåŒ…ç›®å½•ï¼ˆå­˜æ”¾æ ¸å¿ƒåº“ã€ç»„ä»¶æˆ–é€»è¾‘ä»£ç ï¼‰
â”‚   â”œâ”€ core/                      # æ ¸å¿ƒåŒ…ï¼ˆä¾‹å¦‚ç»„ä»¶åº“ã€å·¥å…·åº“ç­‰ï¼‰
â”‚   â”œâ”€ index.ts                   # æ±‡æ€»å¯¼å‡ºï¼ˆå¯é›†ä¸­å¯¼å‡ºå¤šä¸ªå­åŒ…ï¼‰
â”‚   â”œâ”€ tsconfig.json              # packages å±‚çº§çš„ TypeScript é…ç½®ï¼ˆæ–¹ä¾¿å„åŒ…å…±äº«ï¼‰
â”‚   â””â”€ package.json               # packages å±‚çº§å®šä¹‰ï¼ˆå¯å£°æ˜å†…éƒ¨ä¾èµ–å…³ç³»ï¼‰
â”‚
â”œâ”€ play/                          # æ²™ç›’é¡¹ç›®ï¼Œç”¨äºæœ¬åœ°å¼€å‘å’Œæµ‹è¯• core åŒ…
â”‚   â”œâ”€ public/                    # é™æ€èµ„æºç›®å½•ï¼ˆfaviconã€é™æ€å›¾ç‰‡ç­‰ï¼‰
â”‚   â”œâ”€ src/                       # Vue åº”ç”¨æºç ç›®å½•
â”‚   â”‚   â”œâ”€ App.vue                # æ ¹ç»„ä»¶
â”‚   â”‚   â””â”€ main.ts                # åº”ç”¨å…¥å£æ–‡ä»¶
â”‚   â”œâ”€ index.html                 # Vite å¯åŠ¨å…¥å£ HTML
â”‚   â”œâ”€ vite.config.ts             # Vite é…ç½®æ–‡ä»¶ï¼ˆä½¿ç”¨ @vitejs/plugin-vueï¼‰
â”‚   â”œâ”€ tsconfig.json              # play å­åŒ…çš„ TypeScript é…ç½®ï¼ˆç»§æ‰¿æ ¹é…ç½®ï¼‰
â”‚   â””â”€ package.json               # play å­åŒ…ä¾èµ–ä¸è„šæœ¬å®šä¹‰
â”‚
â”œâ”€ docs/                          # é¡¹ç›®æ–‡æ¡£ç›®å½•ï¼ˆå¯æ”¾æ–‡æ¡£ç«™ç‚¹ã€Storybook æˆ– VitePressï¼‰
â”‚
â”œâ”€ .gitignore                     # Git å¿½ç•¥è§„åˆ™ï¼ˆå¿½ç•¥ node_modulesã€distã€ç¼“å­˜æ–‡ä»¶ç­‰ï¼‰
â”œâ”€ .editorconfig                  # è·¨ç¼–è¾‘å™¨ç»Ÿä¸€ä»£ç é£æ ¼ï¼ˆç¼©è¿›ã€æ¢è¡Œç¬¦ã€ç¼–ç ç­‰åŸºç¡€è§„èŒƒï¼‰
â”œâ”€ package.json                   # æ ¹åŒ…é…ç½®ï¼ˆç®¡ç†å·¥ä½œåŒºä¾èµ–ã€Huskyã€lint-stagedã€å…¨å±€å‘½ä»¤ï¼‰
â”œâ”€ eslint.config.ts               # ESLint é…ç½®æ–‡ä»¶ï¼ˆå®šä¹‰ Vue + TS æ ¡éªŒè§„åˆ™ï¼‰
â”œâ”€ .prettierrc.json               # Prettier é…ç½®æ–‡ä»¶ï¼ˆä»£ç æ ¼å¼åŒ–è§„åˆ™ï¼‰
â”œâ”€ pnpm-workspace.yaml            # pnpm å·¥ä½œåŒºå®šä¹‰æ–‡ä»¶ï¼ˆåˆ—å‡ºå‚ä¸ Monorepo çš„å­åŒ…ç›®å½•ï¼‰
â””â”€ tsconfig.json                  # æ ¹ TypeScript é…ç½®ï¼ˆé€šç”¨è§„åˆ™ + å¼•ç”¨å„å­åŒ…ï¼‰
```